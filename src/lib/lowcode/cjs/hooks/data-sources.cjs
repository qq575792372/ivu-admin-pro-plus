"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const g=require("vue"),h=require("./global.cjs");function V({props:u,emits:c}){const{getGlobalProperties:b}=h.default({props:u,emits:c}),{$request:d,$message:m}=b(),p=g.computed(()=>u.globalConfig.dataSources),i=g.computed(()=>u.globalConfig||{}),F=async function(r,t={},l){let o=q(r);try{let n=y(o,t,l,i.value.globalVars),e=await d.request(n);return new Function("result","DSV","$globalVars",o.responseCode).bind(l).call(null,e,t,i.value.globalVars)}catch(n){new Function("error","DSV","$globalVars","$message",o.responseErrorCode).bind(l).call(null,n,t,i.value.globalVars,m)}},q=function(r){return p.value.find(t=>t.name===r)},y=function(r,t={},l,o){let n={};if(r.urlType==="String")n.url=String(r.url);else if(r.urlType==="VarFx"){let C=new Function("DSV","$globalVars","return "+String(r.url)).bind(l);n.url=C(t,o)}n.method=r.method;let e=a(r.headers,t,l,o);e&&(n.headers=e);let s=a(r.params,t,l,o);s&&(n.params=s);let f=a(r.data,t,l,o);return f&&(n.data=f),new Function("config","DSV","$globalVars",r.requestCode).bind(l).call(null,n,t,o)},a=function(r,t={},l,o){if(!r||r.length<=0)return;let n={};for(let e of r)if(e.type==="String")n[e.name]=String(e.value);else if(e.type==="Number")n[e.name]=Number(e.value);else if(e.type==="Boolean")n[e.name]=!!e.value;else if(e.type==="VarFx"){let s=new Function("DSV","$globalVars","return "+e.value).bind(l);n[e.name]=s(t,o)}else{console.error("data source not support type!");return}return n};return{requestData:F}}exports.default=V;
